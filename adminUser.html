<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý người dùng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- icon boostrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.css">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>

    </style>
</head>

<body>
    <div class="row">
        <div class="col-md-2 bg-dark text-white p-4 ">
            <h3 class="text-center"><span class="text-danger">Hugn</span><span>Shop</span></h3>
            <hr>
            <p><i class="bi bi-pie-chart-fill me-2"></i><a class="text-decoration-none text-white"
                    href="adminDashboard.html">
                    Quản lý thống kê</a></p>
            <p><i class="bi bi-tag-fill me-2"></i><a class="text-decoration-none text-white" href="adminCate.html"> Quản
                    lý
                    danh mục</a></p>
            <p><i class="bi bi-box-seam me-2"></i><a class="text-decoration-none text-white" href="adminProduct.html">
                    Quản lý
                    sản phẩm</a></p>
            <p><i class="bi bi-people-fill me-2"></i><a class="text-decoration-none text-white" href="adminUser.html">
                    Quản lý
                    người dùng</a></p>
            <p><i class="bi bi-cart-fill me-2"></i><a class="text-decoration-none text-white" href="/order"> Quản lý đơn
                    hàng</a></p>
            <p><i class="bi bi-chat-left-text-fill me-2"></i><a class="text-decoration-none text-white"
                    href="/feedback"> Quản lý bình luận</a></p>
            <hr>
            <div class="text-center">
                <a href="" class="btn btn-danger">Đăng xuất</a>
            </div>
        </div>
        <div class="col-md-10 p-0">
            <div class="shadow bg-info text-white d-flex justify-content-between align-content-center  p-3 pb-1">
                <p>TRANG QUẢN TRỊ WEBSITE HugnShop</p>
                <div>
                    <span><a class="link-light" href="index.html">Quay lại trang chủ</a></span>
                </div>
            </div>


            <div class="row p-5">
                <div>
                    <h1>Quản lý người dùng</h1>
                    <button data-bs-toggle="modal" data-bs-target="#myModal-4" class="btn btn-secondary">Thêm tài
                        khoản</button>
                </div>
                <!-- Thêm user -->
                <div class="modal" id="myModal-4">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Thêm người dùng</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <!-- Modal body -->
                            <div class="modal-body">
                                <form>

                                    <div class="mb-3 mt-3">
                                        <label for="username" class="form-label">Tên đăng nhập:</label>
                                        <input type="text" class="form-control" id="username"
                                            placeholder="Nhập tên đăng nhập">
                                    </div>
                                    <div class="mb-3 mt-3">
                                        <label for="password" class="form-label">Mật khẩu:</label>
                                        <input type="password" class="form-control" id="password"
                                            placeholder="Nhập mật khẩu">
                                    </div>
                                    <div class="mb-3 mt-3">
                                        <label for="role" class="form-label">Quyền:</label>
                                        <input type="text" class="form-control" id="role"
                                            placeholder="Nhập quyền người dùng">
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="addUser()">Thêm người
                                        dùng</button>
                                </form>
                            </div>
                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sửa user -->
                <div class="modal" id="myModal-5">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title">Sửa người dùng</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <!-- Modal body -->
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3 mt-3">
                                        <label for="editUsername" class="form-label">Tên đăng nhập:</label>
                                        <input type="text" class="form-control" id="editUsername"
                                            placeholder="Nhập tên đăng nhập mới">
                                    </div>
                                    <div class="mb-3 mt-3">
                                        <label for="editPassword" class="form-label">Mật khẩu:</label>
                                        <input type="password" class="form-control" id="editPassword"
                                            placeholder="Nhập mật khẩu mới">
                                    </div>
                                    <div class="mb-3 mt-3">
                                        <label for="editRole" class="form-label">Quyền:</label>
                                        <input type="text" class="form-control" id="editRole"
                                            placeholder="Nhập quyền người dùng mới">
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="updateUser()">Sửa người
                                        dùng</button>
                                </form>
                            </div>
                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row p-5" id="showUsers">

                </div>
            </div>

            <!-- Footer -->
            <div class="bg-info text-white text-center p-2">
                <p>@2024 by Nguyễn Bảo Hưng</p>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
                crossorigin="anonymous"></script>
</body>

</html>
<script>
    // User
    addUser = () => {
        let username = document.getElementById("username").value.trim();
        let password = document.getElementById("password").value.trim();
        let role = document.getElementById("role").value.trim();

        if (username === "" || password === "") {
            alert("Vui lòng điền đầy đủ thông tin người dùng.");
            return;
        }

        if (role === "") {
            role = "user";
        }

        let newUser = {
            username: username,
            password: password,
            role: role
        };

        axios.post("http://localhost:3000/users", newUser)
            .then(res => {
                showUsers();
                document.getElementById("username").value = "";
                document.getElementById("password").value = "";
                document.getElementById("role").value = "";
            })
            .catch(err => {
                console.error('Error adding user', err);
            });
    }

    editUser = (id) => {
        // Thay đổi biến global editUserID thành id của người dùng được chọn
        editUserID = id;
        // Gọi API để lấy thông tin của người dùng cần chỉnh sửa
        axios.get(`http://localhost:3000/users/${id}`)
            .then(res => {
                // Hiển thị thông tin của người dùng trong modal
                document.getElementById("editUsername").value = res.data.username;
                document.getElementById("editPassword").value = res.data.password;
                document.getElementById("editRole").value = res.data.role;
            })
            .catch(err => {
                console.error('Error fetching user data', err);
            });
    }


    updateUser = () => {
        let editUsername = document.getElementById("editUsername");
        let editPassword = document.getElementById("editPassword");
        let editRole = document.getElementById("editRole");
        if (!editUsername.value || !editPassword.value) {
            alert("Vui lòng nhập đầy đủ thông tin");
            return;
        }
        // Kiểm tra nếu editUserID vẫn giữ giá trị mặc định, tức là không có người dùng nào được chọn để sửa
        if (editUserID === -1) {
            alert("Vui lòng chọn một người dùng để sửa");
            return;
        }
        // Tạo đối tượng updateUser với thông tin mới
        let updateUser = {
            username: editUsername.value,
            password: editPassword.value,
            role: editRole.value
        };
        // Gửi yêu cầu cập nhật thông tin người dùng đến server
        axios.put(`http://localhost:3000/users/${editUserID}`, updateUser)
            .then(res => {
                showUsers();
            })
            .catch(err => {
                console.error('Error updating user', err);
            });
    }

    deleteUser = (id) => {
        if (confirm("Bạn có chắc chắn muốn xóa người dùng này không?")) {
            axios.delete(`http://localhost:3000/users/${id}`)
                .then(res => {
                    showUsers();
                });
        }
    }

    // Hiển thị người dùng
    renderUsers = (users) => {
        let htmlString = `
        <table class="table">
            <tr>
                <th>ID người dùng</th>
                <th>Tên đăng nhập</th>
                <th>Mật khẩu</th>
                <th>Quyền</th>
                <th>Hành động</th>
            </tr>`;
        users.forEach(user => {
            htmlString += `
            <tr>
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td>${user.password}</td>
                <td>${user.role}</td>
                <td>
                    <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#myModal-5" onclick="editUser('${user.id}')">Sửa</button>
                    <button class="btn btn-danger" onclick="deleteUser('${user.id}')">Xóa</button>
                </td>
            </tr>`;
        });
        htmlString += `</table>`;
        document.getElementById("showUsers").innerHTML = htmlString;
    };

    showUsers = () => {
        axios.get("http://localhost:3000/users")
            .then(res => {
                renderUsers(res.data);
            })
            .catch(err => {
                console.error('Error fetching users', err);
            });
    };

    showUsers();


</script>